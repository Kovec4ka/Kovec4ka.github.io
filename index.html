<!DOCTYPE html>
<html>
<head>
  <title>Калькулятор цен</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #222;
      color: #eee;
      margin: 0; /* Убираем отступы */
      padding: 0; /* Убираем отступы */
      display: flex;
      flex-direction: column; /* Выравниваем по вертикали */
      align-items: center; /* Центрируем элементы */
    }

    .container {
      width: 90%; /* Занимаем 90% ширины экрана */
      max-width: 500px; /* Максимальная ширина */
      padding: 20px;
      margin: 20px auto; /* Центрируем контейнер */
    }

    h1 {
      font-size: 2rem; /* Увеличиваем размер заголовка */
      text-align: center;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 1.5rem; /* Увеличиваем размер заголовка */
      text-align: center;
      margin-bottom: 10px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      font-size: 1rem; /* Уменьшаем размер шрифта */
      flex: 1 1 100px; /* Делаем кнопки адаптивными */
      min-width: 100px; /* Минимальная ширина кнопок */
    }

    .hidden {
      display: none;
    }

    #total, #discount, #services-count {
      font-size: 1.2rem; /* Увеличиваем размер текста */
      margin-bottom: 10px;
      text-align: center;
    }

    #date-picker {
      margin-bottom: 10px;
      width: 100%;
    }

    #toggle-button {
      background-color: #f44336; /* Красный цвет для выделения */
      font-size: 1rem; /* Уменьшаем размер шрифта */
    }

    #services {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    #services .button-group {
      flex-wrap: wrap; /* Делаем группы кнопок адаптивными */
      justify-content: center;
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>Калькулятор цен</h1>

    <div id="login">
      <h2>Вход</h2>
      <input type="text" id="username" placeholder="Введите имя">
      <button onclick="login()">Войти</button>
    </div>

    <div id="content" class="hidden">
      <h2>Ваши данные</h2>
      <p>Привет, <span id="user-name"></span>!</p>

      <div id="date-picker">
        <label for="selected-date">Выберите дату:</label>
        <input type="date" id="selected-date" value="<?php echo date('Y-m-d'); ?>">
      </div>

      <div id="total">
        Общая сумма: 0
      </div>
      <div id="discount">
        Скидка: 0
      </div>
      <div id="services-count">
        Количество услуг: 0
      </div>

      <button onclick="resetTotal()">Обнулить счет</button>
      <button onclick="removeLast()">Убрать предыдущее</button>
      <button onclick="logout()">Выйти</button>

      <button id="toggle-button">Показать все услуги</button>
      <div id="services" class="hidden">
        <div class="button-group">
          <button onclick="addPrice('эконом1 (I)', 800)">эконом1 (I)</button>
          <button onclick="addPrice('эконом2 (I)', 1300)">эконом2 (I)</button>
          <button onclick="addPrice('нано1 (I)', 900)">нано1 (I)</button>
          <button onclick="addPrice('нано2 (I)', 1400)">нано2 (I)</button>
          <button onclick="addPrice('эконом1 (II)', 1000)">эконом1 (II)</button>
          <button onclick="addPrice('эконом2 (II)', 1500)">эконом2 (II)</button>
          <button onclick="addPrice('нано1 (II)', 1200)">нано1 (II)</button>
          <button onclick="addPrice('нано2 (II)', 1700)">нано2 (II)</button>
        </div>
        <div class="button-group">
          <button onclick="addPrice('экспресс (I)', 500)">экспресс (I)</button>
          <button onclick="addPrice('экспресс (II)', 600)">экспресс (II)</button>
          <button onclick="addPrice('экспресс (IV)', 1000)">экспресс (IV)</button>
          <button onclick="addPrice('кварц1 (I)', 2000)">кварц1 (I)</button>
          <button onclick="addPrice('кварц2 (I)', 2500)">кварц2 (I)</button>
          <button onclick="addPrice('кварц1 (II)', 2200)">кварц1 (II)</button>
          <button onclick="addPrice('кварц2 (II)', 2700)">кварц2 (II)</button>
        </div>
        <div class="button-group">
          <button onclick="addPrice('салон I', 1000)">салон I</button>
          <button onclick="addPrice('салон II', 1300)">салон II</button>
          <button onclick="addPrice('днище', 400)">днище</button>
          <button onclick="addPrice('чернение', 300)">чернение</button>
          <button onclick="addPrice('силикон', 250)">силикон</button>
          <button onclick="addPrice('полировка пластика', 500)">полировка пластика</button>
          <button onclick="addPrice('двигатель', 2500)">двигатель</button>
        </div>
      </div>
    </div>

    <script>
      let total = 0;
      let selectedServices = [];
      let selectedDate = "<?php echo date('Y-m-d'); ?>"; // Текущая дата по умолчанию
      let period = null; // Период для подсчета суммы (null - не определен)

      // Загружаем данные из localStorage при загрузке страницы
      window.onload = () => {
        loadSavedData();
        updateTotal(); // Обновляем сумму при загрузке
      };

      function addPrice(service, price) {
        total += price;
        selectedServices.push(service);
        updateTotal();
        saveSelectedServices();
      }

      function updateTotal() {
        const discount = total * 0.27;
        document.getElementById('total').textContent = `Общая сумма: ${total}`;
        document.getElementById('discount').textContent = `Скидка: ${discount.toFixed(2)}`;
        document.getElementById('services-count').textContent = `Количество услуг: ${selectedServices.length}`;

        // Определение периода
        const dateParts = selectedDate.split('-');
        const day = parseInt(dateParts[2]);
        if (day <= 15) {
          period = 1; // 1-й период (1-15)
        } else {
          period = 2; // 2-й период (16-30/31)
        }

        // Вывод информации о периоде
        if (period) {
          // Получение общей суммы для периода из localStorage
          const periodTotal = parseInt(localStorage.getItem(`periodTotal-${selectedDate}-${period}`), 10) || 0;
          const periodDiscount = parseFloat(localStorage.getItem(`periodDiscount-${selectedDate}-${period}`), 10) || 0;

          // Обновление общей суммы для периода
          const newPeriodTotal = periodTotal + total;
          const newPeriodDiscount = periodDiscount + discount;
          localStorage.setItem(`periodTotal-${selectedDate}-${period}`, newPeriodTotal);
          localStorage.setItem(`periodDiscount-${selectedDate}-${period}`, newPeriodDiscount);

          // Вывод общей суммы и скидки для периода
          document.getElementById('services-count').textContent += ` (период ${period}: ${newPeriodTotal} (скидка: ${newPeriodDiscount.toFixed(2)}))`;
        }
      }

      function resetTotal() {
        total = 0;
        selectedServices = [];
        updateTotal();
        saveSelectedServices();
      }

      function removeLast() {
        if (selectedServices.length > 0) {
          const lastService = selectedServices.pop();
          const price = getPrice(lastService);
          total -= price;
          updateTotal();
          saveSelectedServices();
        }
      }
      function getPrice(service) {
        switch (service) {
          case 'эконом1 (I)': return 800;
		  case 'эконом1 (II)': return 1000;
		  case 'эконом2 (I)': return 1300;
		  case 'эконом2 (II)': return 1500;
		  
          
          case 'нано1 (I)': return 900;
          case 'нано2 (I)': return 1400;
		  case 'нано1 (II)': return 1200;
          case 'нано2 (II)': return 1700;
          
		  
          case 'экспресс (I)': return 500;
          case 'экспресс (II)': return 600;
          case 'экспресс (IV)': return 1000;
		  
          case 'кварц1 (I)': return 2000;
          case 'кварц2 (I)': return 2500;
          case 'кварц1 (II)': return 2200;
          case 'кварц2 (II)': return 2700;
		  
          case 'салон I': return 1000;
          case 'салон II': return 1300;
          case 'днище': return 400;
          case 'чернение': return 300;
          case 'силикон': return 250;
          case 'полировка пластика': return 500;
          case 'двигатель': return 2500;
          default: return 0;
        }
      }

      function login() {
        const username = document.getElementById('username').value;
        if (username) {
          document.getElementById('user-name').textContent = username;
          document.getElementById('content').classList.remove('hidden');
          document.getElementById('login').classList.add('hidden');
          saveUsername(username);
        }
      }

      function saveUsername(username) {
        localStorage.setItem('username', username);
      }

      function saveSelectedServices() {
        localStorage.setItem(`selectedServices-${selectedDate}`, JSON.stringify(selectedServices));
        localStorage.setItem(`total-${selectedDate}`, total); // Сохраняем общую сумму
      }

      function loadSavedData() {
        const username = localStorage.getItem('username');
        if (username) {
          document.getElementById('user-name').textContent = username;
          document.getElementById('content').classList.remove('hidden');
          document.getElementById('login').classList.add('hidden');
        }

        // Загружаем данные для выбранной даты
        const savedServices = localStorage.getItem(`selectedServices-${selectedDate}`);
        if (savedServices) {
          selectedServices = JSON.parse(savedServices);
        }
        total = parseInt(localStorage.getItem(`total-${selectedDate}`), 10) || 0; // Загружаем общую сумму
      }

      function logout() {
        localStorage.removeItem('username');
        document.getElementById('content').classList.add('hidden');
        document.getElementById('login').classList.remove('hidden');
      }

      document.getElementById('toggle-button').addEventListener('click', () => {
        const servicesElement = document.getElementById('services');
        servicesElement.classList.toggle('hidden');
        if (servicesElement.classList.contains('hidden')) {
          document.getElementById('toggle-button').textContent = 'Показать все услуги';
        } else {
          document.getElementById('toggle-button').textContent = 'Скрыть услуги';
        }
      });

      // Обработка изменения даты
      document.getElementById('selected-date').addEventListener('change', (event) => {
        selectedDate = event.target.value;
        loadSavedData(); // Загружаем данные для новой даты
        updateTotal(); // Обновляем общую сумму
      });
    </script>
  </div>
</body>
</html>